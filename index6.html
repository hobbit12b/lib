<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Toetsomgeving</title>
<style>
    :root{
        --main-blue:#0D99FF;
        --light-grey:#F0F2F5;
        --medium-grey:#E9ECEF;
        --tile-border:#ECECEC;
        --tile-shadow:rgba(0,0,0,.06);
        --text-color:#222;
        --white:#FFFFFF;
        --red:#C44444;

        --keypad-maxwidth:300px;
        --keypad-gap:10px;

        --page-padding-x:24px;

        /* wordt door JS gezet zodat de afbeelding nooit te groot wordt */
        --img-max-h: 60vh;
    }

    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    *{box-sizing:border-box}
    html,body{min-height:100%}
    body{
        margin:0;
        font-family:'Poppins',sans-serif;
        background:var(--light-grey);
        display:flex;
        justify-content:center;
        align-items:stretch;
        padding:1.5vh;
        color:var(--text-color);
    }

    .toets-container{
        width:100%;
        background:var(--white);
        border-radius:20px;
        box-shadow:0 10px 40px rgba(0,0,0,.1);
        display:flex;
        flex-direction:column;
        min-height:100vh;
        height:auto;
        max-width:1400px;
        overflow:visible;
    }
    @supports (min-height: 100dvh){
        .toets-container{ min-height:100dvh; }
    }

    /* Blauwe lijn */
    .brand-strip-wrap{ padding:10px var(--page-padding-x) 0 var(--page-padding-x); }
    .brand-strip{
        height:4px; border-radius:4px; background:var(--main-blue);
        box-shadow:0 1px 0 rgba(255,255,255,.35) inset;
    }

    /* Vraag */
    .vraag-blok{
        display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
        padding:14px var(--page-padding-x) 8px var(--page-padding-x);
    }
    .vraag-tekst{
        font-weight:600; color:#1f2937;
        font-size:clamp(1.05rem, 2.4vh, 1.3rem);
        line-height:1.55; margin:0;
    }
    .play-button{
        background:var(--main-blue); border:0; border-radius:10px; padding:8px 10px; cursor:pointer;
        align-self:flex-start; box-shadow:0 2px 0 rgba(13,153,255,.25);
    }
    .play-button svg{width:28px;height:28px;fill:#fff}

    /* Main twee kolommen */
    .toets-main{
        flex:1;
        display:flex;
        gap:clamp(16px,3vw,32px);
        padding:0 var(--page-padding-x) 16px var(--page-padding-x);
        min-height:0;
        align-items:center;
        overflow:visible;
    }

    .image-container{
        flex:1.5 1 0;
        display:flex;
        justify-content:center;
        align-items:center;   /* verticaal en horizontaal gecentreerd */
        min-width:0;
    }
    .image-container img{
        width:auto;
        max-width:100%;
        /* de sleutel: absolute bovengrens op basis van berekende vrije hoogte */
        max-height:var(--img-max-h);
        object-fit:contain;
        border-radius:10px;
    }

    .interaction-container{
        flex:1 1 0;
        display:flex; flex-direction:column; align-items:center; justify-content:center;
        gap:10px; min-width:0;
    }

    /* schaalbare rechtergroep: outer krijgt exacte doelhoogte, stack wordt geschaald en gecentreerd */
    .ia-outer{
        width:100%;
        max-width:var(--keypad-maxwidth);
        position:relative;
        overflow:hidden;
    }
    .ia-stack{
        width:100%;
        transform-origin:top left;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
        gap:2px;
    }

    .keypad-area{
        background:var(--light-grey);
        border:2px solid var(--medium-grey);
        border-radius:16px;
        padding:12px;
        width:100%;
    }
    .keypad{
        display:grid;
        grid-template-columns:repeat(3,1fr);
        gap:var(--keypad-gap);
    }
    .keypad-button{
        aspect-ratio:1/1;
        border-radius:14px;
        background:#fff;
        border:2px solid var(--tile-border);
        box-shadow:0 2px 0 var(--tile-shadow);
        display:flex; align-items:center; justify-content:center;
        font-weight:700; font-size:clamp(1.05rem,3.1vh,1.6rem);
        color:#000; cursor:pointer; user-select:none;
        transition:transform .05s ease;
    }
    .keypad-button:active{ transform:translateY(1px) }
    .keypad-button.empty{ visibility:hidden }
    .keypad-button.backspace{ background:var(--red); border-color:var(--red); box-shadow:0 2px 0 rgba(0,0,0,.08); }
    .keypad-button.backspace svg{ width:44%; height:44%; fill:#fff; }

    .antwoord-wrap{ width:100%; }
    .antwoord-vak{
        width:100%; border:2px solid var(--medium-grey); border-radius:12px;
        min-height:50px;
        padding:8px 14px;
        font-size:clamp(1rem,2.3vh,1.25rem);
        background:#fff;
    }
    .antwoord-vak:focus{ outline:2px solid var(--main-blue); border-color:var(--main-blue); }

    /* Footer sticky */
    .toets-footer{
        position:sticky; bottom:0; z-index:10;
        background:#F8F9FA; border-top:1px solid #E9ECEF;
        padding:8px var(--page-padding-x);
        display:flex; justify-content:space-between; align-items:center;
    }
    .footer-button{
        padding:10px 18px; border:0; border-radius:25px; cursor:pointer;
        font-size:clamp(.9rem,2vh,1.05rem); font-weight:500;
    }
    .vorige-button{background:#E9ECEF; color:#6D6D6D}
    .volgende-button{background:var(--main-blue); color:#fff}

    .pagination{display:flex; align-items:center; gap:clamp(8px,1.2vw,14px)}
    .page-dot{
        width:clamp(38px,5.6vh,50px); height:clamp(38px,5.6vh,50px);
        border-radius:50%; background:var(--medium-grey); border:2px solid var(--medium-grey);
        color:#4B4B4B; display:inline-flex; align-items:center; justify-content:center;
        font-weight:700; font-size:clamp(.9rem,2vh,1.05rem);
        transition:all .15s ease; cursor:pointer; user-select:none;
    }
    .page-dot.active{
        width:calc(clamp(38px,5.6vh,50px) + 8px);
        height:calc(clamp(38px,5.6vh,50px) + 8px);
        background:var(--main-blue); color:#fff; border-color:var(--main-blue);
    }

    /* Chromebook vensterweergave */
    @media (max-height: 760px) and (min-width: 901px){
        .toets-main{ align-items:center; }
        .interaction-container{ justify-content:flex-start; align-items:flex-start; }
        .ia-outer{ max-width:300px; }
    }

    /* Chromebook fullscreen */
    @media (min-height: 761px) and (min-width: 901px){
        .ia-outer{ max-width:320px; }
    }

    /* Stapelen bij smalle breedte */
    @media (max-width: 900px){
        .toets-main{
            flex-direction:column;
            align-items:stretch;
            padding:0 16px 72px 16px;
        }
        .brand-strip-wrap{ padding:10px 16px 0 16px; }
        .vraag-blok{ padding:12px 16px 6px 16px; }
        .image-container{ min-height:150px; }
        .image-container img{ width:100%; max-width:100%; object-fit:contain; }
        .interaction-container{ justify-content:flex-start; align-items:center; }
        .ia-outer{ max-width:300px; }
    }
</style>
</head>
<body>

<div class="toets-container">

    <div class="brand-strip-wrap"><div class="brand-strip" aria-hidden="true"></div></div>

    <div class="vraag-blok">
        <p id="vraag-tekst" class="vraag-tekst">
            Sophie heeft een briefje van tien euro, twee muntjes van twee euro en een muntje van één euro<br>
            Hoeveel euro heeft Sophie in totaal?
        </p>
        <button class="play-button" id="play-vraag-button" aria-label="Lees vraag voor">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
    </div>

    <main class="toets-main">
        <div class="image-container">
            <img id="opdracht-afbeelding" src="01 geld.jpg" alt="Sophie met een 10 euro biljet, twee 2 euro munten en een 1 euro munt"/>
        </div>

        <div class="interaction-container">
            <div class="ia-outer" id="ia-outer">
                <div class="ia-stack" id="ia-stack">
                    <div class="keypad-area" id="keypad-area">
                        <div class="keypad">
                            <button class="keypad-button">1</button>
                            <button class="keypad-button">2</button>
                            <button class="keypad-button">3</button>
                            <button class="keypad-button">4</button>
                            <button class="keypad-button">5</button>
                            <button class="keypad-button">6</button>
                            <button class="keypad-button">7</button>
                            <button class="keypad-button">8</button>
                            <button class="keypad-button">9</button>
                            <button class="keypad-button empty" aria-hidden="true"></button>
                            <button class="keypad-button">0</button>
                            <button class="keypad-button backspace" aria-label="Wissen">
                                <svg viewBox="0 0 24 24">
                                    <path d="M19 7H9L5 12l4 5h10a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Zm-3.41 8.41L14.17 14l1.42-1.41L14.17 11l1.42-1.41L17 11.17l1.41-1.58L19.83 11l-1.42 1.41L19.83 14l-1.42 1.41L17 13.83l-1.41 1.58Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="antwoord-wrap" id="antwoord-wrap">
                        <input type="text" class="antwoord-vak" placeholder="Antwoordvak" inputmode="numeric" />
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="toets-footer" id="toets-footer">
        <button class="footer-button vorige-button" id="btn-prev">Vorige</button>
        <div class="pagination" role="tablist" aria-label="Pagina navigatie">
            <button class="page-dot active" role="tab" aria-selected="true" aria-label="Pagina 1">1</button>
            <button class="page-dot" role="tab" aria-selected="false" aria-label="Pagina 2">2</button>
            <button class="page-dot" role="tab" aria-selected="false" aria-label="Pagina 3">3</button>
            <button class="page-dot" role="tab" aria-selected="false" aria-label="Pagina 4">4</button>
            <button class="page-dot" role="tab" aria-selected="false" aria-label="Pagina 5">5</button>
        </div>
        <button class="footer-button volgende-button" id="btn-next">Volgende</button>
    </footer>

</div>

<script>
document.addEventListener('DOMContentLoaded',() => {
    const keypadButtons=document.querySelectorAll('.keypad-button');
    const antwoordVak=document.querySelector('.antwoord-vak');
    const playButton=document.getElementById('play-vraag-button');
    const vraagNode=document.getElementById('vraag-tekst');
    const footerNode=document.getElementById('toets-footer');
    const brandWrap=document.querySelector('.brand-strip-wrap');
    const vraagTekst=vraagNode ? vraagNode.innerHTML.replace('<br>',' ') : '';

    /* keypad invoer */
    keypadButtons.forEach(btn=>{
        btn.addEventListener('click',()=>{
            if(btn.classList.contains('backspace')){
                antwoordVak.value=antwoordVak.value.slice(0,-1);
            }else if(btn.textContent.trim()!==''){
                antwoordVak.value+=btn.textContent.trim();
            }
            antwoordVak.focus();
        });
    });
    antwoordVak.addEventListener('keydown',e=>{
        if(!/^[0-9]$/.test(e.key)&&e.key.length===1){ e.preventDefault(); }
    });

    /* voorleesfunctie */
    playButton?.addEventListener('click',()=>{
        if(!('speechSynthesis' in window)) return;
        speechSynthesis.cancel();
        const u=new SpeechSynthesisUtterance(vraagTekst);
        u.lang='nl-NL';
        const voices=speechSynthesis.getVoices();
        let v=voices.find(x=>x.lang==='nl-NL'&&/female|vrouw|ellen|xander/i.test(x.name));
        if(!v){ v=voices.find(x=>x.lang==='nl-NL'); }
        if(v){ u.voice=v; }
        u.pitch=1.1; u.rate=0.95;
        speechSynthesis.speak(u);
    });

    /* media queries */
    const mqChromebook = window.matchMedia('(max-height: 760px) and (min-width: 901px)');      // venster
    const mqChromebookFull = window.matchMedia('(min-height: 761px) and (min-width: 901px)');   // fullscreen

    const img = document.getElementById('opdracht-afbeelding');
    const iaOuter = document.getElementById('ia-outer');
    const iaStack = document.getElementById('ia-stack');

    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    /* beschikbare hoogte voor de afbeelding berekenen, zodat die nooit uit beeld valt */
    function updateImgMaxHeight(){
        const vpH = window.visualViewport ? window.visualViewport.height : window.innerHeight;

        const brandH = brandWrap ? brandWrap.getBoundingClientRect().height : 0;
        const vraagH = vraagNode ? vraagNode.closest('.vraag-blok').getBoundingClientRect().height : 0;
        const footerH = footerNode ? footerNode.getBoundingClientRect().height : 0;

        /* marge voor paddings en lucht in het middengebied */
        const safety = 24;

        /* beschikbare hoogte voor het middengebied */
        let avail = vpH - brandH - vraagH - footerH - safety;

        /* iets groter toestaan in fullscreen, maar altijd grenzen */
        if(mqChromebookFull.matches){ avail *= 1.06; }

        /* onder- en bovengrens tegen extreem smalle of hoge schermen */
        avail = clamp(avail, 140, vpH * 0.82);

        document.documentElement.style.setProperty('--img-max-h', `${Math.round(avail)}px`);
    }

    function measureNaturalHeight(el){
        const prev = { transform:el.style.transform, position:el.style.position, top:el.style.top, left:el.style.left };
        el.style.transform = 'none';
        el.style.position = 'static';
        el.style.top = '';
        el.style.left = '';
        const h = el.getBoundingClientRect().height;
        el.style.transform = prev.transform;
        el.style.position = prev.position;
        el.style.top = prev.top;
        el.style.left = prev.left;
        return h;
    }

    function syncRightStackToImage(){
        if(!img || !iaOuter || !iaStack) return;

        const imgH = Math.round(img.getBoundingClientRect().height);
        if(imgH<=0) return;

        /* maak de drager even hoog als de afbeelding */
        iaOuter.style.height = imgH + 'px';

        /* schaal de stack zodat hij in die hoogte past, centreer exact */
        const hNat = measureNaturalHeight(iaStack);
        if(hNat<=0) return;

        let s = imgH / hNat;
        if(mqChromebook.matches){ s = Math.min(1, s); }            /* venster, niet opblazen */
        if(mqChromebookFull.matches){ s = Math.min(1.06, s); }     /* fullscreen, iets groter mag */

        iaStack.style.position = 'absolute';
        iaStack.style.top = '50%';
        iaStack.style.left = '50%';
        iaStack.style.transformOrigin = 'top left';
        iaStack.style.transform = `translate(-50%,-50%) scale(${s})`;
    }

    function relayout(){
        updateImgMaxHeight();
        /* wacht een frame zodat de nieuwe max-height is toegepast, daarna de rechter stack syncen */
        requestAnimationFrame(syncRightStackToImage);
    }

    window.addEventListener('resize', relayout);
    mqChromebook.addEventListener?.('change', relayout);
    mqChromebookFull.addEventListener?.('change', relayout);

    if(img && !img.complete){
        img.addEventListener('load', relayout, {once:true});
    }

    relayout();

    /* paginanavigatie */
    const dots=[...document.querySelectorAll('.page-dot')];
    const prev=document.getElementById('btn-prev');
    const next=document.getElementById('btn-next');
    function setActive(i){
        dots.forEach((d,idx)=>{
            const active=idx===i;
            d.classList.toggle('active',active);
            d.setAttribute('aria-selected',String(active));
        });
    }
    dots.forEach((d,i)=>{
        d.addEventListener('click',()=>setActive(i));
        d.addEventListener('keydown',e=>{
            if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setActive(i); }
        });
    });
    prev.addEventListener('click',()=>{
        const cur=dots.findIndex(d=>d.classList.contains('active'));
        setActive(Math.max(0,cur-1));
    });
    next.addEventListener('click',()=>{
        const cur=dots.findIndex(d=>d.classList.contains('active'));
        setActive(Math.min(dots.length-1,cur+1));
    });
});
</script>

</body>
</html>
