<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Voorbeeldtoets Groep 3, Oefenomgeving — aangepast</title>
<style>
:root{ --bg:#f2f2f2; --panel:#fff; --blue:#0d6efd; --blue-dark:#0b5ed7; --line:#e6e6e6; --text:#000; --muted:#666; --ok:#2fb073; --wrong:#b02f2f; --amber:#c58a00; }
html,body{height:100%;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;font-size:16px;color:var(--text);background:var(--bg)}
.sky{height:70px;background:var(--blue);border-bottom:2px solid var(--line)}
.stage{display:flex;justify-content:center;align-items:flex-start;padding:40px 16px 120px}
.card{background:var(--panel);width:960px;min-height:620px;border-radius:12px;box-shadow:0 1px 6px rgba(0,0,0,.08);padding:24px 28px;position:relative;overflow:hidden}
h1{font-size:20px;font-weight:bold;margin:0 0 14px;line-height:1.4}
p{font-size:16px;line-height:1.5;margin:0 0 10px}
.q{font-size:17px;font-weight:bold;margin:14px 0 8px}
.input{font-size:16px;padding:8px 10px;border-radius:6px;border:1px solid #bbb;width:220px}
.choices{margin-top:6px}
.choice{display:block;margin-bottom:6px}
.feedback{margin-top:8px;font-weight:bold}
.ok{color:var(--ok)}
.wrong{color:var(--wrong)}
/* 1, voortgang rechtsboven weg */
.progress{display:none}
/* Audio knoppen bij opdrachten, direct boven de vraag */
.ttsRow{display:inline-flex;align-items:center;gap:10px;margin-left:8px}
.ttsImgBtn{border:0;background:transparent;padding:0;margin-left:8px;cursor:pointer;display:inline-flex;align-items:center}
.ttsImgBtn img{width:36px;height:36px;display:block}
.audioBtn{border:0;background:#eee;width:40px;height:40px;border-radius:20px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}
.audioBtn svg{width:18px;height:18px;fill:var(--blue)}
/* Fix, zorg dat pauzeplaatje even groot is als het play icoon */
.audioBtn img{width:18px;height:18px;display:block;object-fit:contain}
.task{display:none}
.task.active{display:block}
.inner-panel{background:#fff;border-radius:16px;box-shadow:inset 0 0 0 1px #eee;margin:10px auto 0;width:820px;height:360px;position:relative;overflow:hidden}
.scene-play,.scene-pause{position:absolute;left:50%;top:36px;transform:translateX(-50%);width:58px;height:58px;border:0;background:transparent;padding:0;cursor:pointer}
.scene-play img,.scene-pause img{width:100%;height:100%;display:block}
.scene-pause.hidden,.scene-play.hidden{display:none}
.scene-boy{position:absolute;left:50%;top:120px;transform:translateX(-50%);height:170px;width:auto}
.scene-girl{position:absolute;right:34px;bottom:22px;height:190px;width:auto}
.hidden{display:none}
.hide-ui .progress{display:none}
/* toolbar verwijderd */
.btn{border:1px solid #d0d0d0;background:#fff;border-radius:8px;padding:10px 14px;font-weight:bold;cursor:pointer}
.btn:hover{background:#f4f6ff}
.btn[disabled]{opacity:.5;cursor:not-allowed}
/* Eindscherm, minimalistisch overzicht met aanklikbare rondjes */
.review{display:none}
.review.show{display:block}
.circles{display:flex;flex-wrap:wrap;gap:10px;margin:14px 0}
.circleBtn{ width:44px;height:44px;border-radius:22px;border:1px solid #d7d7d7;background:#eee; display:inline-flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;line-height:1 }
.circleBtn.done{background:#fff}
.endTitle{font-weight:bold;margin-top:4px}
/* Onderbalk zoals Cito */
.bottomNav{ position:absolute;left:18px;right:18px;bottom:18px; display:flex;align-items:center;justify-content:space-between;gap:12px; background:#fafafa;border:1px solid #ececec;border-radius:12px;padding:10px 12px; }
.navBtn{ border:0;background:var(--blue);color:#fff;border-radius:10px;padding:10px 18px; font-weight:bold;cursor:pointer }
.navBtn[disabled]{ background:#e0e0e0;color:#666;border:1px solid #d0d0d0;cursor:not-allowed;opacity:1; }
.pager{display:flex;align-items:center;gap:8px;justify-content:center;flex:1}
.pageBtn{ width:44px;height:44px;border-radius:22px;border:1px solid #d7d7d7;background:#eee; display:inline-flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer; padding:0;line-height:1; }
.pageBtn.current{ width:56px;height:56px;border-radius:28px;font-size:18px; background:var(--blue);color:#fff;border-color:var(--blue); }
/* default is grijs, beantwoord = wit, current = blauw */
.pageBtn.answered:not(.current){background:#fff}
.ellipsis{padding:0 6px;color:#777;user-select:none}
/* 5, onderbalk in eindscherm weg */
.end-view .bottomNav{display:none}
</style>
</head>
<body>
<div class="sky"></div>
<div class="stage">
<main class="card">

<!-- 1. Intro (Verborgen) -->
<section class="task active" data-kind="intro" data-tts="Controle van geluid. Druk op de knop met de driehoek. Als het geluid werkt druk je op het vierkantje." style="display:none;">
<h1>Controle van het geluid</h1>
<p><button id="audioPlay" class="audioBtn" aria-label="Speel geluid">
<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
</button></p>
<p class="q"><label><input type="checkbox" class="check" id="soundOk"> Het geluid werkt</label></p>
<p class="q">Werkt het niet, meld dit aan je docent.</p>
</section>

<!-- 2. Scene -->
<section class="task" data-kind="scene" data-tts="Uitlegscreen">
<h1>Luisteren naar de uitleg</h1>
<div class="inner-panel" aria-label="Uitlegscherm">
<img src="jongetje.jpg" alt="Jongen" class="scene-boy">
<img src="meisje.jpg" alt="Meisje" class="scene-girl">
<button id="scenePlay" class="scene-play" aria-label="Afspelen" title="Afspelen">
<img src="speel.jpg" alt="Afspelen">
</button>
<button id="scenePause" class="scene-pause hidden" aria-label="Pauzeer" title="Pauzeer">
<img src="pauze.jpg" alt="Pauze">
</button>
</div>
</section>

<!-- 3. Opgaven -->
<section class="task" data-kind="task" data-answer="7" data-tts="Opgave 1, splits dertien in twee delen, het eerste deel is zes, wat is het tweede deel">
<h1>Opgave 1</h1>
<p class="q">Splits 13 in twee delen. Het eerste deel is 6. Wat is het tweede deel
<button class="ttsImgBtn" aria-label="Speel opgave" title="Speel opgave"><img src="speel.jpg" alt="Speel"></button>
</p>
<input class="input" inputmode="numeric" />
<div class="feedback"></div>
</section>

<!-- Eindscherm -->
<section class="task review" data-kind="end" data-tts="Klaar, je bent nu bij het eindscherm, controleer of je alle opgaven hebt gemaakt">
<h1>Klaar</h1>
<p class="endTitle">Je bent nu bij het eindscherm. Controleer of je alle opdrachten hebt gemaakt.</p>
<div id="endCircles" class="circles" aria-label="Overzicht opgaven"></div>
</section>

<!-- Onderbalk -->
<div class="bottomNav" aria-label="Navigatie onder">
<button id="prevBtn" class="navBtn" aria-label="Vorige">Vorige</button>
<div id="pager" class="pager" aria-label="Opgaven"></div>
<button id="nextBtn" class="navBtn" aria-label="Volgende">Volgende</button>
</div>
</main>
</div>

<script>
(function(){
  const tasks=[...document.querySelectorAll('.task')];
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');
  const pager=document.getElementById('pager');
  // indices
  const taskIndexes = tasks.map((t,ix)=>({ix, kind:t.dataset.kind}));
  const itemIx = taskIndexes.filter(x=>x.kind==='task').map(x=>x.ix);
  const firstTask = itemIx[0];
  const introIx = tasks.findIndex(t=>t.dataset.kind==='intro');
  const sceneIx = tasks.findIndex(t=>t.dataset.kind==='scene');
  
  // administratie
  let i=0, score=0;
  const state = itemIx.reduce((acc,ix)=>{ acc[ix] = { answered:false, correct:null, value:null }; return acc; },{});

  // Geluidstest
  const soundOk = document.getElementById('soundOk');
  const audioBtn = document.getElementById('audioPlay');
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let ctx = null;

  function ensureCtx() {
    if (!ctx && AudioCtx) {
      ctx = new AudioCtx();
    }
  }

  function playDrum(time, freq = 150, dur = 0.2, type = 'sine') {
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.connect(g);
    g.connect(ctx.destination);
    o.type = type;
    o.frequency.setValueAtTime(freq, time);
    g.gain.setValueAtTime(1, time);
    g.gain.exponentialRampToValueAtTime(0.001, time + dur);
    o.start(time);
    o.stop(time + dur);
  }

  function playDrumPatternAt(now) {
    DRUM_PATTERN.forEach(p => playDrum(now + p.offset, p.freq, 0.15, p.type));
  }

  let soundLoopTimeouts = [];

  function stopSoundLoop() {
    soundLoopTimeouts.forEach(id => clearTimeout(id));
    soundLoopTimeouts = [];
  }

  function playDrumPatternRepeated(times = 3, gapMs = 900) {
    ensureCtx();
    if (!ctx) return;
    stopSoundLoop();
    for (let r = 0; r < times; r++) {
      const tId = setTimeout(() => {
        const now = ctx.currentTime;
        playDrumPatternAt(now);
      }, r * gapMs);
      soundLoopTimeouts.push(tId);
    }
  }

  const originalAudioBtnHTML = audioBtn ? audioBtn.innerHTML : '';
  if (audioBtn) {
    audioBtn.addEventListener('click', () => {
      const loops = 4, gap = 1000;
      playDrumPatternRepeated(loops, gap);
      audioBtn.innerHTML = '<img src="pauze.jpg" alt="Pauze">';
      const totalMs = loops * gap + 200;
      setTimeout(() => {
        if (tasks[i]?.dataset.kind === 'intro') {
          audioBtn.innerHTML = originalAudioBtnHTML;
        }
      }, totalMs);
    });
  }

  function setNextEnabled(on) {
    nextBtn.disabled = !on;
  }

  function stopAllTTS() {
    document.querySelectorAll('.ttsImgBtn').forEach(btn => {
      const img = btn.querySelector('img');
      if (img) img.src = 'speel.jpg';
      btn.dataset.playing = 'false';
    });
    showPlayIcon();
  }

  function showPlayIcon() {
    if (scenePause) scenePause.classList.add('hidden');
    if (scenePlay) scenePlay.classList.remove('hidden');
  }

  function show(k) {
    tasks.forEach((t, ix) => t.classList.toggle('active', ix === k));
    const active = tasks[k];
    const kind = active?.dataset.kind;

    // Verberg de intro (geluidscontrole wordt uitgevoerd zonder dat het zichtbaar is)
    if (kind === 'intro') return; // Skip intro-screen

    // Show scene if applicable
    if (kind === 'scene') {
      document.body.classList.add('hide-ui');
    } else {
      document.body.classList.remove('hide-ui');
    }
    stopAllTTS();
    if (kind === 'task') {
      setNextEnabled(true);
      renderPager();
    }
  }

  // Navigatie: direct naar scene na intro-overslaan
  nextBtn.addEventListener('click', () => {
    const kind = tasks[i].dataset.kind;
    if (kind === 'intro') {
      i = sceneIx >= 0 ? sceneIx : i;
      show(i);
      return;
    }
    if (kind === 'scene') {
      i = firstTask >= 0 ? firstTask : i;
      show(i);
      return;
    }
    if (kind === 'task') {
      check(i);
      const idx = itemIx.indexOf(i);
      const next = itemIx[idx + 1];
      if (next !== undefined) { i = next; show(i); }
      else {
        i = tasks.findIndex(t => t.dataset.kind === 'end');
        if (i < 0) i = tasks.length - 1;
        show(i);
      }
    }
  });

  // start zonder geluidscontrole zichtbaar
  function init() {
    i = sceneIx >= 0 ? sceneIx : 0; // start direct met het scène scherm
    show(i);
  }

  init();
})();
</script>
</body>
</html>
